"use strict";(()=>{var e={};e.id=668,e.ids=[668],e.modules={5113:e=>{e.exports=require("@azure/identity")},8700:e=>{e.exports=require("@azure/monitor-query")},6042:e=>{e.exports=require("applicationinsights")},7641:e=>{e.exports=require("exceljs")},6985:e=>{e.exports=require("express-rate-limit")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},1412:e=>{e.exports=import("@azure/identity")},9914:e=>{e.exports=import("@azure/keyvault-secrets")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},2333:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{config:()=>d,default:()=>l,routeModule:()=>u});var n=r(1802),i=r(7153),o=r(6249),s=r(5783),c=e([s]);s=(c.then?(await c)():c)[0];let l=(0,o.l)(s,"default"),d=(0,o.l)(s,"config"),u=new n.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/exportExcel",pathname:"/api/exportExcel",bundlePath:"",filename:""},userland:s});a()}catch(e){a(e)}})},375:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.d(t,{wg:()=>s});var n=r(1412),i=r(9914);r(1462);var o=e([n,i]);[n,i]=o.then?(await o)():o,new n.DefaultAzureCredential;let s={maxRequestsPerMinute:60,jwtSecret:process.env.JWT_SECRET||"your-default-secret",allowedOrigins:(process.env.CORS_ALLOWED_ORIGINS||"").split(",")};process.env.LOG_LEVEL,process.env.MONITORING_SAMPLE_RATE,a()}catch(e){a(e)}})},3066:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.d(t,{AS:()=>o});var n=r(375),i=e([n]);n=(i.then?(await i)():i)[0];let s=null;try{s=r(6985);let{trackException:e}=r(1462)}catch(e){console.error("Error importing server-side modules:",e)}function o(e){return async(t,r)=>e(t,r)}s&&s({windowMs:6e4,max:n.wg.maxRequestsPerMinute}),a()}catch(e){a(e)}})},1462:(e,t,r)=>{r.r(t),r.d(t,{queryLogs:()=>h,startOperation:()=>m,stopOperation:()=>k,trackDependency:()=>p,trackEvent:()=>l,trackException:()=>c,trackMetric:()=>d,trackRequest:()=>u});let a=null,n=null,i=null;try{a=r(6042);let{DefaultAzureCredential:e}=r(5113),{LogAnalyticsClient:t}=r(8700);n=e,i=t}catch(e){console.error("Error importing server-side modules:",e)}class o{constructor(){this.initialized=!1,this.initializeAppInsights(),this.initializeLogAnalytics()}static getInstance(){return o.instance||(o.instance=new o),o.instance}initializeAppInsights(){!this.initialized&&process.env.APPLICATIONINSIGHTS_CONNECTION_STRING&&a&&(a.setup(process.env.APPLICATIONINSIGHTS_CONNECTION_STRING).setAutoDependencyCorrelation(!0).setAutoCollectRequests(!0).setAutoCollectPerformance(!0).setAutoCollectExceptions(!0).setAutoCollectDependencies(!0).setAutoCollectConsole(!0).setUseDiskRetryCaching(!0).setSendLiveMetrics(!0).setDistributedTracingMode(a.DistributedTracingModes.AI_AND_W3C),a.defaultClient.context.tags[a.defaultClient.context.keys.cloudRole]="HigueraFunction",a.start(),this.client=a.defaultClient,this.initialized=!0)}initializeLogAnalytics(){if(n&&i)try{let e=new n;this.logAnalyticsClient=new i(e)}catch(e){console.error("Error initializing Log Analytics client:",e)}}trackException(e,t){if(this.initialized)try{let r={...t,errorName:e.name,stackTrace:e.stack,timestamp:new Date().toISOString()};this.client.trackException({exception:e,properties:r})}catch(e){console.error("Error tracking exception:",e)}}trackEvent(e,t){if(this.initialized)try{let r={...t,timestamp:new Date().toISOString(),environment:process.env.AZURE_ENVIRONMENT||"development"};this.client.trackEvent({name:e,properties:r})}catch(e){console.error("Error tracking event:",e)}}trackMetric(e,t,r){if(this.initialized)try{let a={...r,timestamp:new Date().toISOString(),environment:process.env.AZURE_ENVIRONMENT||"development"};this.client.trackMetric({name:e,value:t,properties:a})}catch(e){console.error("Error tracking metric:",e)}}trackRequest(e,t,r,a,n){if(this.initialized)try{let i={...n,timestamp:new Date().toISOString(),environment:process.env.AZURE_ENVIRONMENT||"development"};this.client.trackRequest({name:e,url:t,duration:r,success:a,properties:i})}catch(e){console.error("Error tracking request:",e)}}trackDependency(e,t,r,a,n){if(this.initialized)try{let i={...n,timestamp:new Date().toISOString(),environment:process.env.AZURE_ENVIRONMENT||"development"};this.client.trackDependency({name:e,data:t,duration:r,success:a,properties:i,dependencyTypeName:"HTTP"})}catch(e){console.error("Error tracking dependency:",e)}}async queryLogs(e,t){if(!this.logAnalyticsClient)return null;try{let r=process.env.LOG_ANALYTICS_WORKSPACE_ID;if(!r)throw Error("LOG_ANALYTICS_WORKSPACE_ID not configured");return await this.logAnalyticsClient.queryWorkspace(r,e,{timeRange:t})}catch(e){throw this.initialized&&this.trackException(e,{operation:"queryLogs"}),e}}startOperation(e){if(!this.initialized)return null;try{return this.client.startOperation({name:e})}catch(e){return console.error("Error starting operation:",e),null}}stopOperation(e){if(this.initialized&&e)try{this.client.stopOperation(e)}catch(e){console.error("Error stopping operation:",e)}}}let s=o.getInstance(),c=(e,t)=>s.trackException(e,t),l=(e,t)=>s.trackEvent(e,t),d=(e,t,r)=>s.trackMetric(e,t,r),u=(e,t,r,a,n)=>s.trackRequest(e,t,r,a,n),p=(e,t,r,a,n)=>s.trackDependency(e,t,r,a,n),h=(e,t)=>s.queryLogs(e,t),m=e=>s.startOperation(e),k=e=>s.stopOperation(e)},5783:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{default:()=>u});var n=r(3066),i=r(1462),o=e([n]);n=(o.then?(await o)():o)[0];let c=null,l=null,d=null;try{c=r(2048),l=r(5315),d=r(7641)}catch(e){console.error("Error importing server-side modules:",e)}async function s(e,t){if(!c||!l||!d)return t.status(500).json({error:"Server-side modules not available"});if("GET"!==e.method)return t.status(405).json({error:"Method not allowed"});let r=performance.now();try{let e=l.join(process.cwd(),"public","data","data.json"),a=c.readFileSync(e,"utf8"),n=JSON.parse(a),o=new d.Workbook;o.creator="Higuera Project Dashboard",o.lastModifiedBy="API",o.created=new Date,o.modified=new Date;let s=o.addWorksheet("Project Overview");s.columns=[{header:"Parameter",key:"parameter",width:25},{header:"Value",key:"value",width:15},{header:"Notes",key:"notes",width:40}],s.addRows([{parameter:"Project Start",value:n.hoursTracking.startDate,notes:""},{parameter:"Planned End Date",value:n.hoursTracking.plannedEndDate,notes:""},{parameter:"Projected End Date",value:n.hoursTracking.projectedEndDate,notes:"Based on current burndown rate"},{parameter:"Total Budget",value:n.kpis.totalBudget,notes:"USD"},{parameter:"Spent",value:n.kpis.spent,notes:"USD"},{parameter:"Remaining",value:n.kpis.remaining,notes:"USD"},{parameter:"Overrun Risk",value:n.kpis.risk,notes:""},{parameter:"Total Hours Allocated",value:n.hoursTracking.totalHoursAllocated,notes:""},{parameter:"Total Hours Used",value:n.hoursTracking.totalHoursUsed,notes:""},{parameter:"Hours Remaining",value:n.hoursTracking.completionMetrics.hoursRemaining,notes:""},{parameter:"Percent Complete",value:`${n.hoursTracking.completionMetrics.percentageComplete}%`,notes:""},{parameter:"Burndown Rate",value:n.hoursTracking.completionMetrics.burndownRate,notes:"Hours per week"},{parameter:"Estimated Weeks Remaining",value:n.hoursTracking.completionMetrics.estimatedWeeksRemaining,notes:""}]),s.getColumn("parameter").font={bold:!0};let u=o.addWorksheet("Weekly Hours");if(u.columns=[{header:"Week Ending",key:"weekEnding",width:15},{header:"Planned Hours",key:"hoursPlanned",width:15},{header:"Actual Hours",key:"hoursActual",width:15},{header:"Cumulative Planned",key:"cumulativePlanned",width:20},{header:"Cumulative Actual",key:"cumulativeActual",width:20},{header:"Hours Variance",key:"hoursVariance",width:15}],n.hoursTracking.weeklyHours.forEach(e=>{u.addRow({weekEnding:e.weekEnding,hoursPlanned:e.hoursPlanned,hoursActual:e.hoursActual,cumulativePlanned:e.cumulativePlanned,cumulativeActual:e.cumulativeActual,hoursVariance:e.hoursActual-e.hoursPlanned})}),u.eachRow((e,t)=>{t>1?t%2&&e.eachCell({includeEmpty:!0},e=>{e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"F5F5F5"}}}):e.eachCell({includeEmpty:!0},e=>{e.font={bold:!0},e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"E0E0E0"}}})}),n.workerHours&&n.workerHours.length>0){let e=o.addWorksheet("Worker Hours");e.columns=[{header:"Worker Name",key:"workerName",width:15},{header:"Week Ending",key:"weekEnding",width:15},{header:"Monday",key:"monday",width:10},{header:"Tuesday",key:"tuesday",width:10},{header:"Wednesday",key:"wednesday",width:10},{header:"Thursday",key:"thursday",width:10},{header:"Friday",key:"friday",width:10},{header:"Total Hours",key:"totalHours",width:15}],n.workerHours.forEach(t=>{e.addRow({workerName:t.workerName,weekEnding:t.weekEnding,monday:t.hours.monday,tuesday:t.hours.tuesday,wednesday:t.hours.wednesday,thursday:t.hours.thursday,friday:t.hours.friday,totalHours:t.totalHours})}),e.getRow(1).font={bold:!0},e.getRow(1).fill={type:"pattern",pattern:"solid",fgColor:{argb:"E0E0E0"}}}let p=o.addWorksheet("Task Completion");p.columns=[{header:"Task",key:"task",width:20},{header:"Planned %",key:"planned",width:15},{header:"Actual %",key:"actual",width:15},{header:"Variance",key:"variance",width:15}],n.schedule.forEach(e=>{p.addRow({task:e.task,planned:e.Planned,actual:e.Actual,variance:e.Actual-e.Planned})}),p.getRow(1).font={bold:!0};let h=o.addWorksheet("Issues");h.columns=[{header:"Date",key:"date",width:15},{header:"System",key:"system",width:15},{header:"Issue",key:"issue",width:30},{header:"Impact",key:"impact",width:20},{header:"Accountability",key:"accountability",width:20},{header:"Consequence",key:"consequence",width:25}],n.issues.forEach(e=>{h.addRow({date:e.date,system:e.system,issue:e.issue,impact:e.impact,accountability:e.accountability,consequence:e.consequence})}),h.getRow(1).font={bold:!0};let m=await o.xlsx.writeBuffer(),k=performance.now()-r;(0,i.trackMetric)("excelExportDuration",k),(0,i.trackEvent)("excelExport",{sheets:o.worksheets.map(e=>e.name),rows:{weekly:n.hoursTracking.weeklyHours.length,workers:n.workerHours?n.workerHours.length:0,tasks:n.schedule.length,issues:n.issues.length}}),t.setHeader("Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"),t.setHeader("Content-Disposition",`attachment; filename=Higuera-Project-Export-${new Date().toISOString().split("T")[0]}.xlsx`),t.status(200).send(Buffer.from(m))}catch(e){console.error("Excel export error:",e),(0,i.trackEvent)("excelExportError",{message:e.message,stack:e.stack}),t.status(500).json({error:e.message||"Failed to export Excel file"})}}let u=(0,n.AS)(s);a()}catch(e){a(e)}})},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=2333);module.exports=r})();