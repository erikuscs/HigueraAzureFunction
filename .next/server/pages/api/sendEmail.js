"use strict";(()=>{var e={};e.id=719,e.ids=[719],e.modules={5113:e=>{e.exports=require("@azure/identity")},8700:e=>{e.exports=require("@azure/monitor-query")},6042:e=>{e.exports=require("applicationinsights")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},208:(e,t,r)=>{r.r(t),r.d(t,{config:()=>p,default:()=>l,routeModule:()=>u});var i={};r.r(i),r.d(i,{default:()=>c});var n=r(1802),o=r(7153),a=r(6249),s=r(1462);async function c(e,t){let r=performance.now();try{if("POST"!==e.method)throw Error("Method not allowed");let i=e.headers.authorization;if(!i?.startsWith("Bearer "))throw Error("Invalid authorization header");let n=i.substring(7);if(!n)throw Error("No bearer token provided");let{dashboardData:o}=e.body;if(!o)throw Error("No dashboard data provided");let a="http://localhost:7071";if(!a)throw Error("Azure Function URL not configured");let c=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({dashboardData:o})}),l=await c.json();if(!c.ok)throw Error(l.error||"Failed to send email");let p=performance.now()-r;return(0,s.trackMetric)("apiEmailDuration",p),t.status(200).json(l)}catch(i){console.error("Error forwarding request to Azure Function:",i),(0,s.trackException)(i,{operation:"sendEmailApi",authorization:e.headers.authorization?"present":"missing",statusCode:i.response?.status,functionEndpoint:"configured"});let r="Method not allowed"===i.message?405:i.message.includes("authorization")?401:i.response?.status||500;return t.status(r).json({error:i.message,timestamp:new Date().toISOString()})}}let l=(0,a.l)(i,"default"),p=(0,a.l)(i,"config"),u=new n.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/sendEmail",pathname:"/api/sendEmail",bundlePath:"",filename:""},userland:i})},1462:(e,t,r)=>{r.r(t),r.d(t,{queryLogs:()=>h,startOperation:()=>E,stopOperation:()=>g,trackDependency:()=>d,trackEvent:()=>l,trackException:()=>c,trackMetric:()=>p,trackRequest:()=>u});let i=null,n=null,o=null;try{i=r(6042);let{DefaultAzureCredential:e}=r(5113),{LogAnalyticsClient:t}=r(8700);n=e,o=t}catch(e){console.error("Error importing server-side modules:",e)}class a{constructor(){this.initialized=!1,this.initializeAppInsights(),this.initializeLogAnalytics()}static getInstance(){return a.instance||(a.instance=new a),a.instance}initializeAppInsights(){!this.initialized&&process.env.APPLICATIONINSIGHTS_CONNECTION_STRING&&i&&(i.setup(process.env.APPLICATIONINSIGHTS_CONNECTION_STRING).setAutoDependencyCorrelation(!0).setAutoCollectRequests(!0).setAutoCollectPerformance(!0).setAutoCollectExceptions(!0).setAutoCollectDependencies(!0).setAutoCollectConsole(!0).setUseDiskRetryCaching(!0).setSendLiveMetrics(!0).setDistributedTracingMode(i.DistributedTracingModes.AI_AND_W3C),i.defaultClient.context.tags[i.defaultClient.context.keys.cloudRole]="HigueraFunction",i.start(),this.client=i.defaultClient,this.initialized=!0)}initializeLogAnalytics(){if(n&&o)try{let e=new n;this.logAnalyticsClient=new o(e)}catch(e){console.error("Error initializing Log Analytics client:",e)}}trackException(e,t){if(this.initialized)try{let r={...t,errorName:e.name,stackTrace:e.stack,timestamp:new Date().toISOString()};this.client.trackException({exception:e,properties:r})}catch(e){console.error("Error tracking exception:",e)}}trackEvent(e,t){if(this.initialized)try{let r={...t,timestamp:new Date().toISOString(),environment:process.env.AZURE_ENVIRONMENT||"development"};this.client.trackEvent({name:e,properties:r})}catch(e){console.error("Error tracking event:",e)}}trackMetric(e,t,r){if(this.initialized)try{let i={...r,timestamp:new Date().toISOString(),environment:process.env.AZURE_ENVIRONMENT||"development"};this.client.trackMetric({name:e,value:t,properties:i})}catch(e){console.error("Error tracking metric:",e)}}trackRequest(e,t,r,i,n){if(this.initialized)try{let o={...n,timestamp:new Date().toISOString(),environment:process.env.AZURE_ENVIRONMENT||"development"};this.client.trackRequest({name:e,url:t,duration:r,success:i,properties:o})}catch(e){console.error("Error tracking request:",e)}}trackDependency(e,t,r,i,n){if(this.initialized)try{let o={...n,timestamp:new Date().toISOString(),environment:process.env.AZURE_ENVIRONMENT||"development"};this.client.trackDependency({name:e,data:t,duration:r,success:i,properties:o,dependencyTypeName:"HTTP"})}catch(e){console.error("Error tracking dependency:",e)}}async queryLogs(e,t){if(!this.logAnalyticsClient)return null;try{let r=process.env.LOG_ANALYTICS_WORKSPACE_ID;if(!r)throw Error("LOG_ANALYTICS_WORKSPACE_ID not configured");return await this.logAnalyticsClient.queryWorkspace(r,e,{timeRange:t})}catch(e){throw this.initialized&&this.trackException(e,{operation:"queryLogs"}),e}}startOperation(e){if(!this.initialized)return null;try{return this.client.startOperation({name:e})}catch(e){return console.error("Error starting operation:",e),null}}stopOperation(e){if(this.initialized&&e)try{this.client.stopOperation(e)}catch(e){console.error("Error stopping operation:",e)}}}let s=a.getInstance(),c=(e,t)=>s.trackException(e,t),l=(e,t)=>s.trackEvent(e,t),p=(e,t,r)=>s.trackMetric(e,t,r),u=(e,t,r,i,n)=>s.trackRequest(e,t,r,i,n),d=(e,t,r,i,n)=>s.trackDependency(e,t,r,i,n),h=(e,t)=>s.queryLogs(e,t),E=e=>s.startOperation(e),g=e=>s.stopOperation(e)},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=208);module.exports=r})();