"use strict";(()=>{var e={};e.id=532,e.ids=[532],e.modules={5113:e=>{e.exports=require("@azure/identity")},8700:e=>{e.exports=require("@azure/monitor-query")},6042:e=>{e.exports=require("applicationinsights")},6985:e=>{e.exports=require("express-rate-limit")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},1412:e=>{e.exports=import("@azure/identity")},9914:e=>{e.exports=import("@azure/keyvault-secrets")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},2736:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.r(t),r.d(t,{config:()=>u,default:()=>l,routeModule:()=>p});var n=r(1802),s=r(7153),o=r(6249),a=r(8667),c=e([a]);a=(c.then?(await c)():c)[0];let l=(0,o.l)(a,"default"),u=(0,o.l)(a,"config"),p=new n.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/updateTask",pathname:"/api/updateTask",bundlePath:"",filename:""},userland:a});i()}catch(e){i(e)}})},375:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.d(t,{wg:()=>a});var n=r(1412),s=r(9914);r(1462);var o=e([n,s]);[n,s]=o.then?(await o)():o,new n.DefaultAzureCredential;let a={maxRequestsPerMinute:60,jwtSecret:process.env.JWT_SECRET||"your-default-secret",allowedOrigins:(process.env.CORS_ALLOWED_ORIGINS||"").split(",")};process.env.LOG_LEVEL,process.env.MONITORING_SAMPLE_RATE,i()}catch(e){i(e)}})},3066:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.d(t,{AS:()=>o});var n=r(375),s=e([n]);n=(s.then?(await s)():s)[0];let a=null;try{a=r(6985);let{trackException:e}=r(1462)}catch(e){console.error("Error importing server-side modules:",e)}function o(e){return async(t,r)=>e(t,r)}a&&a({windowMs:6e4,max:n.wg.maxRequestsPerMinute}),i()}catch(e){i(e)}})},1462:(e,t,r)=>{r.r(t),r.d(t,{queryLogs:()=>h,startOperation:()=>g,stopOperation:()=>k,trackDependency:()=>d,trackEvent:()=>l,trackException:()=>c,trackMetric:()=>u,trackRequest:()=>p});let i=null,n=null,s=null;try{i=r(6042);let{DefaultAzureCredential:e}=r(5113),{LogAnalyticsClient:t}=r(8700);n=e,s=t}catch(e){console.error("Error importing server-side modules:",e)}class o{constructor(){this.initialized=!1,this.initializeAppInsights(),this.initializeLogAnalytics()}static getInstance(){return o.instance||(o.instance=new o),o.instance}initializeAppInsights(){!this.initialized&&process.env.APPLICATIONINSIGHTS_CONNECTION_STRING&&i&&(i.setup(process.env.APPLICATIONINSIGHTS_CONNECTION_STRING).setAutoDependencyCorrelation(!0).setAutoCollectRequests(!0).setAutoCollectPerformance(!0).setAutoCollectExceptions(!0).setAutoCollectDependencies(!0).setAutoCollectConsole(!0).setUseDiskRetryCaching(!0).setSendLiveMetrics(!0).setDistributedTracingMode(i.DistributedTracingModes.AI_AND_W3C),i.defaultClient.context.tags[i.defaultClient.context.keys.cloudRole]="HigueraFunction",i.start(),this.client=i.defaultClient,this.initialized=!0)}initializeLogAnalytics(){if(n&&s)try{let e=new n;this.logAnalyticsClient=new s(e)}catch(e){console.error("Error initializing Log Analytics client:",e)}}trackException(e,t){if(this.initialized)try{let r={...t,errorName:e.name,stackTrace:e.stack,timestamp:new Date().toISOString()};this.client.trackException({exception:e,properties:r})}catch(e){console.error("Error tracking exception:",e)}}trackEvent(e,t){if(this.initialized)try{let r={...t,timestamp:new Date().toISOString(),environment:process.env.AZURE_ENVIRONMENT||"development"};this.client.trackEvent({name:e,properties:r})}catch(e){console.error("Error tracking event:",e)}}trackMetric(e,t,r){if(this.initialized)try{let i={...r,timestamp:new Date().toISOString(),environment:process.env.AZURE_ENVIRONMENT||"development"};this.client.trackMetric({name:e,value:t,properties:i})}catch(e){console.error("Error tracking metric:",e)}}trackRequest(e,t,r,i,n){if(this.initialized)try{let s={...n,timestamp:new Date().toISOString(),environment:process.env.AZURE_ENVIRONMENT||"development"};this.client.trackRequest({name:e,url:t,duration:r,success:i,properties:s})}catch(e){console.error("Error tracking request:",e)}}trackDependency(e,t,r,i,n){if(this.initialized)try{let s={...n,timestamp:new Date().toISOString(),environment:process.env.AZURE_ENVIRONMENT||"development"};this.client.trackDependency({name:e,data:t,duration:r,success:i,properties:s,dependencyTypeName:"HTTP"})}catch(e){console.error("Error tracking dependency:",e)}}async queryLogs(e,t){if(!this.logAnalyticsClient)return null;try{let r=process.env.LOG_ANALYTICS_WORKSPACE_ID;if(!r)throw Error("LOG_ANALYTICS_WORKSPACE_ID not configured");return await this.logAnalyticsClient.queryWorkspace(r,e,{timeRange:t})}catch(e){throw this.initialized&&this.trackException(e,{operation:"queryLogs"}),e}}startOperation(e){if(!this.initialized)return null;try{return this.client.startOperation({name:e})}catch(e){return console.error("Error starting operation:",e),null}}stopOperation(e){if(this.initialized&&e)try{this.client.stopOperation(e)}catch(e){console.error("Error stopping operation:",e)}}}let a=o.getInstance(),c=(e,t)=>a.trackException(e,t),l=(e,t)=>a.trackEvent(e,t),u=(e,t,r)=>a.trackMetric(e,t,r),p=(e,t,r,i,n)=>a.trackRequest(e,t,r,i,n),d=(e,t,r,i,n)=>a.trackDependency(e,t,r,i,n),h=(e,t)=>a.queryLogs(e,t),g=e=>a.startOperation(e),k=e=>a.stopOperation(e)},8667:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.r(t),r.d(t,{default:()=>d});var n=r(3066),s=r(1462),o=r(2048),a=r.n(o),c=r(5315),l=r.n(c),u=e([n]);async function p(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});let r=performance.now();try{let{taskName:i,actualPercentage:n,hoursLogged:o}=e.body;if(!i||"number"!=typeof n||!o)return t.status(400).json({error:"Missing required fields"});let c=l().join(process.cwd(),"public","data","data.json"),u=a().readFileSync(c,"utf8"),p=JSON.parse(u),d=p.schedule.findIndex(e=>e.task===i);if(-1===d)return t.status(404).json({error:"Task not found"});let h=p.schedule[d].Actual;p.schedule[d].Actual=n,p.hoursTracking.totalHoursUsed+=o;let g=new Date,k=new Date(g),m=g.getDay();k.setDate(g.getDate()+(5-m+7)%7);let y=k.toISOString().split("T")[0],A=p.hoursTracking.weeklyHours.findIndex(e=>e.weekEnding===y);if(-1!==A){p.hoursTracking.weeklyHours[A].hoursActual+=o,p.hoursTracking.weeklyHours[A].cumulativeActual+=o;for(let e=A+1;e<p.hoursTracking.weeklyHours.length;e++)p.hoursTracking.weeklyHours[e].cumulativeActual+=o}p.hoursTracking.completionMetrics.hoursRemaining=p.hoursTracking.totalHoursAllocated-p.hoursTracking.totalHoursUsed,p.hoursTracking.completionMetrics.percentageComplete=(p.hoursTracking.totalHoursUsed/p.hoursTracking.totalHoursAllocated*100).toFixed(1);let E=p.hoursTracking.weeklyHours.filter(e=>e.hoursActual>0).length,T=p.hoursTracking.totalHoursUsed;p.hoursTracking.completionMetrics.burndownRate=T/E,p.hoursTracking.completionMetrics.estimatedWeeksRemaining=p.hoursTracking.completionMetrics.hoursRemaining/p.hoursTracking.completionMetrics.burndownRate;let f=new Date;f.setDate(f.getDate()+7*p.hoursTracking.completionMetrics.estimatedWeeksRemaining),p.hoursTracking.projectedEndDate=f.toISOString().split("T")[0],a().writeFileSync(c,JSON.stringify(p,null,2)),(0,s.trackEvent)("taskCompleted",{taskName:i,newPercentage:n,originalPercentage:h,hoursLogged:o,projectedEndDate:p.hoursTracking.projectedEndDate});let O=performance.now()-r;return(0,s.trackMetric)("taskUpdateDuration",O),t.status(200).json({success:!0,task:p.schedule[d],hoursTracking:p.hoursTracking,message:"Task and hours tracking updated successfully"})}catch(e){return console.error("Failed to update task:",e),t.status(500).json({error:e.message||"Failed to update task"})}}n=(u.then?(await u)():u)[0];let d=(0,n.AS)(p);i()}catch(e){i(e)}})},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=2736);module.exports=r})();