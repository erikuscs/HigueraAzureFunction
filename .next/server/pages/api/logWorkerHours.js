"use strict";(()=>{var e={};e.id=305,e.ids=[305],e.modules={5113:e=>{e.exports=require("@azure/identity")},8700:e=>{e.exports=require("@azure/monitor-query")},6042:e=>{e.exports=require("applicationinsights")},6985:e=>{e.exports=require("express-rate-limit")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},1412:e=>{e.exports=import("@azure/identity")},9914:e=>{e.exports=import("@azure/keyvault-secrets")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},8961:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.r(t),r.d(t,{config:()=>u,default:()=>l,routeModule:()=>p});var o=r(1802),n=r(7153),s=r(6249),a=r(4357),c=e([a]);a=(c.then?(await c)():c)[0];let l=(0,s.l)(a,"default"),u=(0,s.l)(a,"config"),p=new o.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/logWorkerHours",pathname:"/api/logWorkerHours",bundlePath:"",filename:""},userland:a});i()}catch(e){i(e)}})},375:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.d(t,{wg:()=>a});var o=r(1412),n=r(9914);r(1462);var s=e([o,n]);[o,n]=s.then?(await s)():s,new o.DefaultAzureCredential;let a={maxRequestsPerMinute:60,jwtSecret:process.env.JWT_SECRET||"your-default-secret",allowedOrigins:(process.env.CORS_ALLOWED_ORIGINS||"").split(",")};process.env.LOG_LEVEL,process.env.MONITORING_SAMPLE_RATE,i()}catch(e){i(e)}})},3066:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.d(t,{AS:()=>s});var o=r(375),n=e([o]);o=(n.then?(await n)():n)[0];let a=null;try{a=r(6985);let{trackException:e}=r(1462)}catch(e){console.error("Error importing server-side modules:",e)}function s(e){return async(t,r)=>e(t,r)}a&&a({windowMs:6e4,max:o.wg.maxRequestsPerMinute}),i()}catch(e){i(e)}})},1462:(e,t,r)=>{r.r(t),r.d(t,{queryLogs:()=>g,startOperation:()=>h,stopOperation:()=>k,trackDependency:()=>d,trackEvent:()=>l,trackException:()=>c,trackMetric:()=>u,trackRequest:()=>p});let i=null,o=null,n=null;try{i=r(6042);let{DefaultAzureCredential:e}=r(5113),{LogAnalyticsClient:t}=r(8700);o=e,n=t}catch(e){console.error("Error importing server-side modules:",e)}class s{constructor(){this.initialized=!1,this.initializeAppInsights(),this.initializeLogAnalytics()}static getInstance(){return s.instance||(s.instance=new s),s.instance}initializeAppInsights(){!this.initialized&&process.env.APPLICATIONINSIGHTS_CONNECTION_STRING&&i&&(i.setup(process.env.APPLICATIONINSIGHTS_CONNECTION_STRING).setAutoDependencyCorrelation(!0).setAutoCollectRequests(!0).setAutoCollectPerformance(!0).setAutoCollectExceptions(!0).setAutoCollectDependencies(!0).setAutoCollectConsole(!0).setUseDiskRetryCaching(!0).setSendLiveMetrics(!0).setDistributedTracingMode(i.DistributedTracingModes.AI_AND_W3C),i.defaultClient.context.tags[i.defaultClient.context.keys.cloudRole]="HigueraFunction",i.start(),this.client=i.defaultClient,this.initialized=!0)}initializeLogAnalytics(){if(o&&n)try{let e=new o;this.logAnalyticsClient=new n(e)}catch(e){console.error("Error initializing Log Analytics client:",e)}}trackException(e,t){if(this.initialized)try{let r={...t,errorName:e.name,stackTrace:e.stack,timestamp:new Date().toISOString()};this.client.trackException({exception:e,properties:r})}catch(e){console.error("Error tracking exception:",e)}}trackEvent(e,t){if(this.initialized)try{let r={...t,timestamp:new Date().toISOString(),environment:process.env.AZURE_ENVIRONMENT||"development"};this.client.trackEvent({name:e,properties:r})}catch(e){console.error("Error tracking event:",e)}}trackMetric(e,t,r){if(this.initialized)try{let i={...r,timestamp:new Date().toISOString(),environment:process.env.AZURE_ENVIRONMENT||"development"};this.client.trackMetric({name:e,value:t,properties:i})}catch(e){console.error("Error tracking metric:",e)}}trackRequest(e,t,r,i,o){if(this.initialized)try{let n={...o,timestamp:new Date().toISOString(),environment:process.env.AZURE_ENVIRONMENT||"development"};this.client.trackRequest({name:e,url:t,duration:r,success:i,properties:n})}catch(e){console.error("Error tracking request:",e)}}trackDependency(e,t,r,i,o){if(this.initialized)try{let n={...o,timestamp:new Date().toISOString(),environment:process.env.AZURE_ENVIRONMENT||"development"};this.client.trackDependency({name:e,data:t,duration:r,success:i,properties:n,dependencyTypeName:"HTTP"})}catch(e){console.error("Error tracking dependency:",e)}}async queryLogs(e,t){if(!this.logAnalyticsClient)return null;try{let r=process.env.LOG_ANALYTICS_WORKSPACE_ID;if(!r)throw Error("LOG_ANALYTICS_WORKSPACE_ID not configured");return await this.logAnalyticsClient.queryWorkspace(r,e,{timeRange:t})}catch(e){throw this.initialized&&this.trackException(e,{operation:"queryLogs"}),e}}startOperation(e){if(!this.initialized)return null;try{return this.client.startOperation({name:e})}catch(e){return console.error("Error starting operation:",e),null}}stopOperation(e){if(this.initialized&&e)try{this.client.stopOperation(e)}catch(e){console.error("Error stopping operation:",e)}}}let a=s.getInstance(),c=(e,t)=>a.trackException(e,t),l=(e,t)=>a.trackEvent(e,t),u=(e,t,r)=>a.trackMetric(e,t,r),p=(e,t,r,i,o)=>a.trackRequest(e,t,r,i,o),d=(e,t,r,i,o)=>a.trackDependency(e,t,r,i,o),g=(e,t)=>a.queryLogs(e,t),h=e=>a.startOperation(e),k=e=>a.stopOperation(e)},4357:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.r(t),r.d(t,{default:()=>u});var o=r(3066),n=r(1462),s=e([o]);o=(s.then?(await s)():s)[0];let c=null,l=null;try{c=r(2048),l=r(5315)}catch(e){console.error("Error importing server-side modules:",e)}async function a(e,t){if(!c||!l)return t.status(500).json({error:"Server-side modules not available"});if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});let r=performance.now();try{let{workerName:i,weekEnding:o,hours:s,totalHours:a}=e.body;if(!i||!o||!s||"number"!=typeof a)return t.status(400).json({error:"Missing required fields"});let u=l.join(process.cwd(),"public","data","data.json"),p=c.readFileSync(u,"utf8"),d=JSON.parse(p);d.workerHours||(d.workerHours=[]);let g=d.workerHours.findIndex(e=>e.workerName===i&&e.weekEnding===o);-1!==g?(d.workerHours[g].hours=s,d.workerHours[g].totalHours=a):d.workerHours.push({workerName:i,weekEnding:o,hours:s,totalHours:a});let h=d.hoursTracking.weeklyHours.findIndex(e=>e.weekEnding===o);if(-1!==h){let e=-1!==g?d.workerHours[g].totalHours:0,t=a-e;if(0!==t){d.hoursTracking.weeklyHours[h].hoursActual+=t,d.hoursTracking.weeklyHours[h].cumulativeActual+=t;for(let e=h+1;e<d.hoursTracking.weeklyHours.length;e++)d.hoursTracking.weeklyHours[e].cumulativeActual+=t;d.hoursTracking.totalHoursUsed+=t,d.hoursTracking.completionMetrics.hoursRemaining=d.hoursTracking.totalHoursAllocated-d.hoursTracking.totalHoursUsed,d.hoursTracking.completionMetrics.percentageComplete=(d.hoursTracking.totalHoursUsed/d.hoursTracking.totalHoursAllocated*100).toFixed(1);let e=d.hoursTracking.weeklyHours.filter(e=>e.hoursActual>0).length;d.hoursTracking.completionMetrics.burndownRate=d.hoursTracking.totalHoursUsed/e,d.hoursTracking.completionMetrics.estimatedWeeksRemaining=d.hoursTracking.completionMetrics.hoursRemaining/d.hoursTracking.completionMetrics.burndownRate;let r=new Date;r.setDate(r.getDate()+7*d.hoursTracking.completionMetrics.estimatedWeeksRemaining),d.hoursTracking.projectedEndDate=r.toISOString().split("T")[0]}}let k=l.join(process.cwd(),"public","data","backups");c.existsSync(k)||c.mkdirSync(k,{recursive:!0});let m=new Date().toISOString().replace(/[:.]/g,"-"),y=l.join(k,`data-${m}.json`);c.writeFileSync(y,p),c.writeFileSync(u,JSON.stringify(d,null,2)),(0,n.trackEvent)("workerHoursLogged",{workerName:i,weekEnding:o,totalHours:a,hoursDelta:-1!==g?a-d.workerHours[g].totalHours:a});let w=performance.now()-r;return(0,n.trackMetric)("workerHoursLogDuration",w),t.status(200).json({success:!0,workerHours:d.workerHours.filter(e=>e.workerName===i),hoursTracking:d.hoursTracking,message:"Worker hours logged successfully"})}catch(e){return console.error("Failed to log worker hours:",e),(0,n.trackEvent)("workerHoursError",{message:e.message,stack:e.stack}),t.status(500).json({error:e.message||"Failed to log worker hours"})}}let u=(0,o.AS)(a);i()}catch(e){i(e)}})},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=8961);module.exports=r})();