"use strict";(()=>{var e={};e.id=430,e.ids=[430],e.modules={5113:e=>{e.exports=require("@azure/identity")},8700:e=>{e.exports=require("@azure/monitor-query")},6042:e=>{e.exports=require("applicationinsights")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7773:e=>{e.exports=require("redis")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},6254:(e,t,r)=>{r.r(t),r.d(t,{config:()=>g,default:()=>y,routeModule:()=>f});var i={};r.r(i),r.d(i,{default:()=>E});var n=r(1802),s=r(7153),a=r(6249),o=r(985);let c=null,l=null;try{c=r(7773);let{trackException:e}=r(1462);l=e}catch(e){console.error("Error importing server-side modules:",e)}class u{constructor(){this.isConnected=!1,this.connectionTimeout=null,this.MAX_RETRY_ATTEMPTS=10,this.INITIAL_RETRY_DELAY=100,this.MAX_RETRY_DELAY=5e3,c&&this.initializeRedis()}async initializeRedis(){try{let e=process.env.REDIS_CONNECTION_STRING;if(!e)throw Error("Redis connection string is not configured");this.client=c.createClient({url:e,socket:{tls:!0,reconnectStrategy:e=>e>this.MAX_RETRY_ATTEMPTS?Error("Redis max retries reached"):Math.min(this.INITIAL_RETRY_DELAY*Math.pow(1.5,e),this.MAX_RETRY_DELAY),connectTimeout:15e3}}),this.client.on("error",e=>{l&&l(e,{service:"RedisCache",event:"connection-error"}),this.isConnected=!1,this.scheduleReconnect()}),this.client.on("connect",()=>{this.isConnected=!0,this.connectionTimeout&&(clearTimeout(this.connectionTimeout),this.connectionTimeout=null)}),this.client.on("reconnecting",()=>{l&&l(Error("Redis reconnecting"),{service:"RedisCache",event:"reconnecting"})}),await this.client.connect()}catch(e){l&&l(e,{service:"RedisCache",operation:"initializeRedis"}),this.isConnected=!1,this.scheduleReconnect()}}scheduleReconnect(){this.connectionTimeout||(this.connectionTimeout=setTimeout(()=>{this.connectionTimeout=null,this.initializeRedis().catch(e=>{l&&l(e,{service:"RedisCache",operation:"scheduleReconnect"})})},5e3))}async get(e){if(!this.isConnected)throw new o.AppError("Redis not connected",503);try{let t=await this.client.get(e);return t?JSON.parse(t):null}catch(t){throw l&&l(t,{service:"RedisCache",operation:"get",key:e}),t}}async set(e,t,r=300){if(!this.isConnected)throw new o.AppError("Redis not connected",503);try{let i=JSON.stringify(t);await this.client.set(e,i,{EX:r})}catch(t){throw l&&l(t,{service:"RedisCache",operation:"set",key:e}),t}}async delete(e){if(!this.isConnected)throw new o.AppError("Redis not connected",503);try{await this.client.del(e)}catch(t){throw l&&l(t,{service:"RedisCache",operation:"delete",key:e}),t}}}class h{async get(e){let t=this.cache.get(e);return t?Date.now()>t.expiry?(this.cache.delete(e),null):t.value:null}async set(e,t,r=300){let i=Date.now()+1e3*r;this.cache.set(e,{value:t,expiry:i}),this.cache.size>100&&this.cleanup()}async delete(e){this.cache.delete(e)}cleanup(){let e=Date.now();for(let[t,r]of this.cache.entries())e>r.expiry&&this.cache.delete(t)}constructor(){this.cache=new Map}}class d{constructor(){this.fallbackCache=new h,this.primaryCache=process.env.REDIS_CONNECTION_STRING?new u:this.fallbackCache}static getInstance(){return d.instance||(d.instance=new d),d.instance}async get(e){try{return await this.primaryCache.get(e)}catch(t){return l&&l(t,{service:"CacheService",operation:"get",key:e}),this.fallbackCache.get(e)}}async set(e,t,r){try{await this.primaryCache.set(e,t,r)}catch(i){l&&l(i,{service:"CacheService",operation:"set",key:e}),await this.fallbackCache.set(e,t,r)}}async delete(e){try{await this.primaryCache.delete(e)}catch(t){l&&l(t,{service:"CacheService",operation:"delete",key:e}),await this.fallbackCache.delete(e)}}}let p=d.getInstance(),m={totalBudget:15e4,budgetUsed:65e3,tasksCompleted:24,totalTasks:42,projectProgress:57,nextMilestone:"2025-05-15",recentUpdates:[{date:"2025-04-15",description:"Phase 1 completed"},{date:"2025-04-10",description:"Infrastructure deployment"},{date:"2025-04-05",description:"Design approval"}],taskDistribution:{"Not Started":10,"In Progress":8,Completed:24},resourceAllocation:{development:65,testing:40,deployment:25},monthlyHours:[{month:"Jan",hours:120},{month:"Feb",hours:150},{month:"Mar",hours:180},{month:"Apr",hours:210}]};async function E(e,t){if("GET"!==e.method)return t.status(405).json({message:"Method not allowed"});try{let e="dashboardData",r=await p.get(e);if(r)return t.status(200).json(r);return await p.set(e,m,300),t.status(200).json(m)}catch(e){return console.error("Dashboard API error:",e),t.status(500).json({message:"Failed to retrieve dashboard data",error:void 0})}}let y=(0,a.l)(i,"default"),g=(0,a.l)(i,"config"),f=new n.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/dashboardData",pathname:"/api/dashboardData",bundlePath:"",filename:""},userland:i})},1462:(e,t,r)=>{r.r(t),r.d(t,{queryLogs:()=>p,startOperation:()=>m,stopOperation:()=>E,trackDependency:()=>d,trackEvent:()=>l,trackException:()=>c,trackMetric:()=>u,trackRequest:()=>h});let i=null,n=null,s=null;try{i=r(6042);let{DefaultAzureCredential:e}=r(5113),{LogAnalyticsClient:t}=r(8700);n=e,s=t}catch(e){console.error("Error importing server-side modules:",e)}class a{constructor(){this.initialized=!1,this.initializeAppInsights(),this.initializeLogAnalytics()}static getInstance(){return a.instance||(a.instance=new a),a.instance}initializeAppInsights(){!this.initialized&&process.env.APPLICATIONINSIGHTS_CONNECTION_STRING&&i&&(i.setup(process.env.APPLICATIONINSIGHTS_CONNECTION_STRING).setAutoDependencyCorrelation(!0).setAutoCollectRequests(!0).setAutoCollectPerformance(!0).setAutoCollectExceptions(!0).setAutoCollectDependencies(!0).setAutoCollectConsole(!0).setUseDiskRetryCaching(!0).setSendLiveMetrics(!0).setDistributedTracingMode(i.DistributedTracingModes.AI_AND_W3C),i.defaultClient.context.tags[i.defaultClient.context.keys.cloudRole]="HigueraFunction",i.start(),this.client=i.defaultClient,this.initialized=!0)}initializeLogAnalytics(){if(n&&s)try{let e=new n;this.logAnalyticsClient=new s(e)}catch(e){console.error("Error initializing Log Analytics client:",e)}}trackException(e,t){if(this.initialized)try{let r={...t,errorName:e.name,stackTrace:e.stack,timestamp:new Date().toISOString()};this.client.trackException({exception:e,properties:r})}catch(e){console.error("Error tracking exception:",e)}}trackEvent(e,t){if(this.initialized)try{let r={...t,timestamp:new Date().toISOString(),environment:process.env.AZURE_ENVIRONMENT||"development"};this.client.trackEvent({name:e,properties:r})}catch(e){console.error("Error tracking event:",e)}}trackMetric(e,t,r){if(this.initialized)try{let i={...r,timestamp:new Date().toISOString(),environment:process.env.AZURE_ENVIRONMENT||"development"};this.client.trackMetric({name:e,value:t,properties:i})}catch(e){console.error("Error tracking metric:",e)}}trackRequest(e,t,r,i,n){if(this.initialized)try{let s={...n,timestamp:new Date().toISOString(),environment:process.env.AZURE_ENVIRONMENT||"development"};this.client.trackRequest({name:e,url:t,duration:r,success:i,properties:s})}catch(e){console.error("Error tracking request:",e)}}trackDependency(e,t,r,i,n){if(this.initialized)try{let s={...n,timestamp:new Date().toISOString(),environment:process.env.AZURE_ENVIRONMENT||"development"};this.client.trackDependency({name:e,data:t,duration:r,success:i,properties:s,dependencyTypeName:"HTTP"})}catch(e){console.error("Error tracking dependency:",e)}}async queryLogs(e,t){if(!this.logAnalyticsClient)return null;try{let r=process.env.LOG_ANALYTICS_WORKSPACE_ID;if(!r)throw Error("LOG_ANALYTICS_WORKSPACE_ID not configured");return await this.logAnalyticsClient.queryWorkspace(r,e,{timeRange:t})}catch(e){throw this.initialized&&this.trackException(e,{operation:"queryLogs"}),e}}startOperation(e){if(!this.initialized)return null;try{return this.client.startOperation({name:e})}catch(e){return console.error("Error starting operation:",e),null}}stopOperation(e){if(this.initialized&&e)try{this.client.stopOperation(e)}catch(e){console.error("Error stopping operation:",e)}}}let o=a.getInstance(),c=(e,t)=>o.trackException(e,t),l=(e,t)=>o.trackEvent(e,t),u=(e,t,r)=>o.trackMetric(e,t,r),h=(e,t,r,i,n)=>o.trackRequest(e,t,r,i,n),d=(e,t,r,i,n)=>o.trackDependency(e,t,r,i,n),p=(e,t)=>o.queryLogs(e,t),m=e=>o.startOperation(e),E=e=>o.stopOperation(e)},985:(e,t,r)=>{let i=null;try{let{DefaultAzureCredential:e}=r(5113),{trackException:t}=r(1462);i=t}catch(e){console.error("Error importing server-side modules:",e)}class n extends Error{constructor(e,t=500){super(e),this.name="AppError",this.statusCode=t,Error.captureStackTrace(this,this.constructor)}}async function s(e,t=3,r=1e3){let n;for(let s=0;s<t;s++)try{return await e()}catch(o){if(n=o,!([408,429,500,502,503,504].includes(o.statusCode)||["ETIMEDOUT","ECONNRESET","ECONNREFUSED","EPIPE","EHOSTUNREACH","ENETUNREACH","ESOCKETTIMEDOUT"].includes(o.code)||o.message.toLowerCase().includes("timeout")||o.message.toLowerCase().includes("network")||o.message.toLowerCase().includes("temporarily unavailable"))||s===t-1)throw o;let e=Math.min(r*Math.pow(2,s)+1e3*Math.random(),1e4);i&&i(o,{operation:"retry",attempt:s.toString(),nextDelay:e.toString()}),await a(e)}throw n}function a(e){return new Promise(t=>setTimeout(t,e))}function o(e){if("string"==typeof e)return e.replace(/[<>]/g,"").replace(/javascript:/gi,"").replace(/on\w+=/gi,"").trim();if(Array.isArray(e))return e.map(o);if("object"==typeof e&&null!==e){let t={};for(let[r,i]of Object.entries(e))t[r]=o(i);return t}return e}function c(e){if("number"!=typeof e||isNaN(e))throw new n("Invalid currency value",400);return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}process.env.APPLICATIONINSIGHTS_CONNECTION_STRING,e.exports={AppError:n,withRetry:s,sleep:a,sanitizeInput:o,validateEmail:function(e){return"string"==typeof e&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)},formatDashboardData:function(e){try{if(!e||"object"!=typeof e)throw new n("Invalid dashboard data",400);let t=function(e){if(!e||"object"!=typeof e)throw new n("Invalid KPI data",400);return`
HIGUERA PROJECT - EXECUTIVE SUMMARY

KEY METRICS:
• Total Budget: ${c(e.totalBudget)}
• Spent: ${c(e.spent)}
• Remaining: ${c(e.remaining)}
• Overrun Risk: ${e.risk}
`}(e.kpis),r=function(e){if(!Array.isArray(e))throw new n("Invalid issues data",400);let t=e.slice(0,5).map(e=>`
• ${e.date} - ${e.system}
  Issue: ${o(e.issue)}
  Impact: ${o(e.impact)}
  Accountability: ${o(e.accountability)}`).join("\n");return`
RECENT ISSUES:${t}`}(e.issues),i=function(e){if(!Array.isArray(e))throw new n("Invalid schedule data",400);let t=e.map(e=>`• ${o(e.task)}: Plan ${e.Planned}% vs Actual ${e.Actual}%`).join("\n");return`
SCHEDULE STATUS:
${t}

For detailed charts and visualizations, please visit the project dashboard.
`}(e.schedule);return`${t}${r}${i}`}catch(e){throw i&&i(e,{operation:"formatDashboardData"}),new n("Error formatting dashboard data",500)}},formatCurrency:c,formatErrorResponse:function(e){return{error:{message:e.message,type:e.name,statusCode:e.statusCode||500}}},logError:function(e,t={}){i&&i(e,{...t,timestamp:new Date().toISOString(),errorName:e.name,errorMessage:e.message,stackTrace:e.stack})}}},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=6254);module.exports=r})();