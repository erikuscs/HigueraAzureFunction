"use strict";(()=>{var e={};e.id=80,e.ids=[80],e.modules={5113:e=>{e.exports=require("@azure/identity")},8700:e=>{e.exports=require("@azure/monitor-query")},508:e=>{e.exports=require("@microsoft/microsoft-graph-client")},3822:e=>{e.exports=require("@microsoft/microsoft-graph-client/authProviders/azureTokenCredentials")},6042:e=>{e.exports=require("applicationinsights")},5158:e=>{e.exports=require("jspdf")},5464:e=>{e.exports=require("jspdf-autotable")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},8774:(e,t,r)=>{r.r(t),r.d(t,{config:()=>p,default:()=>d,routeModule:()=>m});var i={};r.r(i),r.d(i,{default:()=>u});var n=r(1802),o=r(7153),a=r(6249),s=r(1462);let l=null;try{let{Client:e}=r(508),{TokenCredentialAuthenticationProvider:t}=r(3822),{DefaultAzureCredential:i}=r(5113),n=r(5158);r(5464),l=n}catch(e){console.error("Error importing server-side modules:",e)}function c(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}async function u(e,t){if(!l)return t.status(500).json({error:"Server-side modules not available"});let r=performance.now();try{if("POST"!==e.method)throw Error("Method not allowed");let{dashboardData:i,filters:n}=e.body;if(!i)throw Error("No dashboard data provided");let o=new l;if(o.setFontSize(20),o.setTextColor(0,51,102),o.text("Higuera Project - Executive Summary",14,20),o.setFontSize(10),o.setTextColor(100,100,100),o.text(`Generated on ${new Date().toLocaleDateString()}`,14,28),n&&(n.week||n.system)&&o.text(`Filters: ${n.week?"Week: "+n.week:""} ${n.system?"System: "+n.system:""}`,14,35),o.setFontSize(14),o.setTextColor(0,51,102),o.text("Key Metrics",14,45),o.autoTable({startY:50,head:[["Metric","Value"]],body:[["Total Budget",c(i.kpis.totalBudget)],["Spent",c(i.kpis.spent)],["Remaining",c(i.kpis.remaining)],["Overrun Risk",i.kpis.risk]],theme:"grid",headStyles:{fillColor:[0,51,102]}}),i.hoursTracking){let e=o.lastAutoTable.finalY+15;o.setFontSize(14),o.setTextColor(0,51,102),o.text("Hours Tracking & Projections",14,e),o.autoTable({startY:e+5,head:[["Metric","Value"]],body:[["Total Hours Allocated",i.hoursTracking.totalHoursAllocated],["Hours Used",i.hoursTracking.totalHoursUsed],["Hours Remaining",i.hoursTracking.completionMetrics.hoursRemaining],["Completion Percentage",`${i.hoursTracking.completionMetrics.percentageComplete}%`],["Planned End Date",new Date(i.hoursTracking.plannedEndDate).toLocaleDateString()],["Projected End Date",new Date(i.hoursTracking.projectedEndDate).toLocaleDateString()],["Estimated Weeks Remaining",i.hoursTracking.completionMetrics.estimatedWeeksRemaining.toFixed(1)]],theme:"grid",headStyles:{fillColor:[0,51,102]}})}let a=o.lastAutoTable.finalY+15;if(o.setFontSize(14),o.setTextColor(0,51,102),o.text("Schedule Status",14,a),o.autoTable({startY:a+5,head:[["Task","Planned %","Actual %"]],body:i.schedule.map(e=>[e.task,e.Planned,e.Actual]),theme:"grid",headStyles:{fillColor:[0,51,102]}}),o.lastAutoTable.finalY>230)o.addPage(),o.setFontSize(14),o.setTextColor(0,51,102),o.text("Recent Issues",14,20),o.autoTable({startY:25,head:[["Date","System","Issue","Impact","Accountability"]],body:(n.system?i.issues.filter(e=>e.system===n.system):i.issues).map(e=>[e.date,e.system,e.issue,e.impact,e.accountability]),theme:"grid",headStyles:{fillColor:[0,51,102]}});else{let e=o.lastAutoTable.finalY+15;o.setFontSize(14),o.setTextColor(0,51,102),o.text("Recent Issues",14,e),o.autoTable({startY:e+5,head:[["Date","System","Issue","Impact","Accountability"]],body:(n.system?i.issues.filter(e=>e.system===n.system):i.issues).map(e=>[e.date,e.system,e.issue,e.impact,e.accountability]),theme:"grid",headStyles:{fillColor:[0,51,102]}})}let u=o.internal.getNumberOfPages();for(let e=1;e<=u;e++)o.setPage(e),o.setFontSize(8),o.setTextColor(150,150,150),o.text(`Higuera Project - Page ${e} of ${u}`,14,o.internal.pageSize.height-10),o.text("Confidential - Ayala Development Inc.",o.internal.pageSize.width-65,o.internal.pageSize.height-10);let d=performance.now()-r;(0,s.trackMetric)("pdfGenerationDuration",d);let p=Buffer.from(o.output("arraybuffer"));t.setHeader("Content-Type","application/pdf"),t.setHeader("Content-Disposition",`attachment; filename=higuera-summary-${new Date().toISOString().split("T")[0]}.pdf`),t.send(p)}catch(i){console.error("PDF generation error:",i),(0,s.trackException)(i,{operation:"generatePdf",filters:JSON.stringify(e.body?.filters),errorDetails:i.toString()});let r="Method not allowed"===i.message?405:500;t.status(r).json({error:i.message,timestamp:new Date().toISOString()})}}let d=(0,a.l)(i,"default"),p=(0,a.l)(i,"config"),m=new n.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/generatePdf",pathname:"/api/generatePdf",bundlePath:"",filename:""},userland:i})},1462:(e,t,r)=>{r.r(t),r.d(t,{queryLogs:()=>m,startOperation:()=>g,stopOperation:()=>h,trackDependency:()=>p,trackEvent:()=>c,trackException:()=>l,trackMetric:()=>u,trackRequest:()=>d});let i=null,n=null,o=null;try{i=r(6042);let{DefaultAzureCredential:e}=r(5113),{LogAnalyticsClient:t}=r(8700);n=e,o=t}catch(e){console.error("Error importing server-side modules:",e)}class a{constructor(){this.initialized=!1,this.initializeAppInsights(),this.initializeLogAnalytics()}static getInstance(){return a.instance||(a.instance=new a),a.instance}initializeAppInsights(){!this.initialized&&process.env.APPLICATIONINSIGHTS_CONNECTION_STRING&&i&&(i.setup(process.env.APPLICATIONINSIGHTS_CONNECTION_STRING).setAutoDependencyCorrelation(!0).setAutoCollectRequests(!0).setAutoCollectPerformance(!0).setAutoCollectExceptions(!0).setAutoCollectDependencies(!0).setAutoCollectConsole(!0).setUseDiskRetryCaching(!0).setSendLiveMetrics(!0).setDistributedTracingMode(i.DistributedTracingModes.AI_AND_W3C),i.defaultClient.context.tags[i.defaultClient.context.keys.cloudRole]="HigueraFunction",i.start(),this.client=i.defaultClient,this.initialized=!0)}initializeLogAnalytics(){if(n&&o)try{let e=new n;this.logAnalyticsClient=new o(e)}catch(e){console.error("Error initializing Log Analytics client:",e)}}trackException(e,t){if(this.initialized)try{let r={...t,errorName:e.name,stackTrace:e.stack,timestamp:new Date().toISOString()};this.client.trackException({exception:e,properties:r})}catch(e){console.error("Error tracking exception:",e)}}trackEvent(e,t){if(this.initialized)try{let r={...t,timestamp:new Date().toISOString(),environment:process.env.AZURE_ENVIRONMENT||"development"};this.client.trackEvent({name:e,properties:r})}catch(e){console.error("Error tracking event:",e)}}trackMetric(e,t,r){if(this.initialized)try{let i={...r,timestamp:new Date().toISOString(),environment:process.env.AZURE_ENVIRONMENT||"development"};this.client.trackMetric({name:e,value:t,properties:i})}catch(e){console.error("Error tracking metric:",e)}}trackRequest(e,t,r,i,n){if(this.initialized)try{let o={...n,timestamp:new Date().toISOString(),environment:process.env.AZURE_ENVIRONMENT||"development"};this.client.trackRequest({name:e,url:t,duration:r,success:i,properties:o})}catch(e){console.error("Error tracking request:",e)}}trackDependency(e,t,r,i,n){if(this.initialized)try{let o={...n,timestamp:new Date().toISOString(),environment:process.env.AZURE_ENVIRONMENT||"development"};this.client.trackDependency({name:e,data:t,duration:r,success:i,properties:o,dependencyTypeName:"HTTP"})}catch(e){console.error("Error tracking dependency:",e)}}async queryLogs(e,t){if(!this.logAnalyticsClient)return null;try{let r=process.env.LOG_ANALYTICS_WORKSPACE_ID;if(!r)throw Error("LOG_ANALYTICS_WORKSPACE_ID not configured");return await this.logAnalyticsClient.queryWorkspace(r,e,{timeRange:t})}catch(e){throw this.initialized&&this.trackException(e,{operation:"queryLogs"}),e}}startOperation(e){if(!this.initialized)return null;try{return this.client.startOperation({name:e})}catch(e){return console.error("Error starting operation:",e),null}}stopOperation(e){if(this.initialized&&e)try{this.client.stopOperation(e)}catch(e){console.error("Error stopping operation:",e)}}}let s=a.getInstance(),l=(e,t)=>s.trackException(e,t),c=(e,t)=>s.trackEvent(e,t),u=(e,t,r)=>s.trackMetric(e,t,r),d=(e,t,r,i,n)=>s.trackRequest(e,t,r,i,n),p=(e,t,r,i,n)=>s.trackDependency(e,t,r,i,n),m=(e,t)=>s.queryLogs(e,t),g=e=>s.startOperation(e),h=e=>s.stopOperation(e)},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=8774);module.exports=r})();